"use strict";(self.webpackChunkaap_felles_frontend=self.webpackChunkaap_felles_frontend||[]).push([[435],{"./packages/aap-felles-react/src/FileInput/FileInput.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Bokmål:()=>Bokmål,Nynorsk:()=>Nynorsk,Primary:()=>Primary,__namedExportsOrder:()=>__namedExportsOrder,default:()=>FileInput_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),esm=__webpack_require__("./node_modules/@navikt/ds-react/esm/index.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),v4=__webpack_require__("./node_modules/uuid/dist/esm-browser/v4.js"),react_esm=__webpack_require__("./node_modules/@navikt/aksel-icons/dist/react/esm/index.js");const FilePanelError=param=>{let{file,onDelete}=param;return(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsxs)(esm.Zk,{className:"fileCard error",tabIndex:0,children:[(0,jsx_runtime.jsxs)("div",{className:"fileCardLeftContent",children:[(0,jsx_runtime.jsx)("div",{className:"fileError",children:(0,jsx_runtime.jsx)(react_esm.dsF,{color:"var(--a-surface-danger-hover)"})}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)(esm.JU,{as:"span",children:file.name})})]}),(0,jsx_runtime.jsxs)("button",{type:"button",onClick:onDelete,tabIndex:0,className:"deleteAttachment",children:[(0,jsx_runtime.jsx)(react_esm.jre,{title:"Avbryt"}),(0,jsx_runtime.jsx)(esm.hC,{children:"Avbryt"})]})]}),(0,jsx_runtime.jsx)("div",{className:"navds-error-message navds-error-message--medium navds-label",children:file.errorMessage})]})};FilePanelError.__docgenInfo={description:"",methods:[],displayName:"FilePanelError",props:{file:{required:!0,tsType:{name:"Vedlegg"},description:""},onDelete:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const FilePanelSuccess=param=>{let{file,onDelete,deleteUrl,readAttachmentUrl}=param;return(0,jsx_runtime.jsxs)(esm.Zk,{className:"fileCard",children:[(0,jsx_runtime.jsxs)("div",{className:"fileCardLeftContent",children:[(0,jsx_runtime.jsx)("div",{className:"fileSuccess",children:(0,jsx_runtime.jsx)(react_esm.Nrt,{color:"var(--a-icon-success)"})}),(0,jsx_runtime.jsxs)("div",{className:"fileInputText",children:[(0,jsx_runtime.jsx)(esm.N_,{target:"_blank",href:"".concat(readAttachmentUrl).concat(file.vedleggId),children:file.name}),(0,jsx_runtime.jsx)(esm.kZ,{children:fileSizeString(file.size)})]})]}),(0,jsx_runtime.jsxs)("button",{onClick:async()=>{(await fetch("".concat(deleteUrl).concat(file.vedleggId),{method:"DELETE"})).ok&&onDelete()},type:"button",tabIndex:0,className:"deleteAttachment","data-testid":"slett-knapp",children:[(0,jsx_runtime.jsx)(react_esm.fKY,{title:"Slett"}),(0,jsx_runtime.jsx)(esm.hC,{children:"Slett"})]})]})};function fileSizeString(size){const kb=size/1024;return kb>1e3?"".concat((kb/1024).toFixed(1)," mB"):"".concat(Math.floor(kb)," kB")}FilePanelSuccess.__docgenInfo={description:"",methods:[],displayName:"FilePanelSuccess",props:{file:{required:!0,tsType:{name:"Vedlegg"},description:""},deleteUrl:{required:!0,tsType:{name:"string"},description:""},readAttachmentUrl:{required:!0,tsType:{name:"string"},description:""},onDelete:{required:!0,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""}}};const nb={inputText:"Dra og slipp",labelText:"Velg dine filer for",fileInputErrors:{unsupportedMediaType:"Filtypen kan ikke lastes opp. Last opp dokumentet i et annet format (PDF, PNG, JPG eller heic). ",fileTooLarge:"Filen(e) du lastet opp er for stor. Last opp fil(er) med maksimal samlet størrelse 50 MB.",virus:"Det er oppdaget virus på filen du prøver å laste opp. Velg en annen fil å laste opp.",size:"Maksimal samlet størrelse på vedlegg per bruker(50MB) er oversteget.",passordbeskyttet:"Filen er passord-beskyttet og vil ikke kunne leses av en saksbehandler, fjern beskyttelsen og prøv igjen",other:"Opplastingen feilet. Prøv på nytt"}},nn={inputText:"Dra og slepp",labelText:"Vel dine filar for",fileInputErrors:{unsupportedMediaType:"Filtypen er ikkje støtta. Last opp dokumentet i eit anna format (PDF, PNG, JPG eller heic).",fileTooLarge:"Éi eller fleire av filene du lasta opp, er større enn det som er tillate. Last opp éi eller fleire fil med ein samla storleik på maks 50 MB.",virus:"Det er oppdaga virus på fila du prøver å laste opp. Last opp ei anna fil.",size:"Maksimal samlet størrelse på vedlegg per bruker(50MB) er oversteget.",passordbeskyttet:"Fila er sikra med passord og vil ikkje vere mogleg for ein saksbehandlar å lese. Opphev passordsikringa og prøv igjen",other:"Opplastinga var mislukka. Prøv på nytt"}},FileInput=props=>{const{heading,ingress,files,onUpload,onDelete,uploadUrl,deleteUrl,id,locale,readAttachmentUrl="nb",...rest}=props,[dragOver,setDragOver]=(0,react.useState)(!1),[isUploading,setIsUploading]=(0,react.useState)(!1),fileInputElement=(0,react.useRef)(null),inputId=(0,react.useMemo)((()=>(0,v4.A)()),[]),tekster=(0,react.useMemo)((()=>"nn"===locale?nn:nb),[locale]);const settFeilmelding=function(statusCode){let substatus=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";switch(statusCode){case 422:return function feilmeldingForSubstatus(substatus){switch(substatus){case"PASSWORD_PROTECTED":return tekster.fileInputErrors.passordbeskyttet;case"VIRUS":return tekster.fileInputErrors.virus;case"SIZE":return tekster.fileInputErrors.size;default:return""}}(substatus);case 413:return tekster.fileInputErrors.fileTooLarge;case 415:return tekster.fileInputErrors.unsupportedMediaType;default:return tekster.fileInputErrors.other}};async function validateAndSetFiles(filelist){setIsUploading(!0);const uploadedFiles=await Promise.all(Array.from(filelist).map((async file=>{const internalErrorMessage=function internalValidate(fileToUpload){const totalUploadedSize=files.reduce(((acc,curr)=>acc+curr.size),0);return["image/png","image/jpg","image/jpeg","application/pdf"].includes(null==fileToUpload?void 0:fileToUpload.type)?totalUploadedSize+(null==fileToUpload?void 0:fileToUpload.size)>52428800?tekster.fileInputErrors.fileTooLarge:void 0:tekster.fileInputErrors.unsupportedMediaType}(file);let uploadResult={vedleggId:(0,v4.A)(),errorMessage:"",type:file.type,size:file.size,name:file.name};if(internalErrorMessage)internalErrorMessage&&(uploadResult.errorMessage=internalErrorMessage);else try{const data=new FormData;data.append("vedlegg",file);const res=await fetch(uploadUrl,{method:"POST",body:data}),resData=await res.json();res.ok?uploadResult.vedleggId=resData:uploadResult.errorMessage=settFeilmelding(res.status,resData.substatus)}catch(err){uploadResult.errorMessage=settFeilmelding((null==err?void 0:err.status)||500)}return uploadResult})));setIsUploading(!1),onUpload(uploadedFiles)}return(0,jsx_runtime.jsxs)("div",{className:"fileInput",id:props.id,children:[(0,jsx_runtime.jsx)(esm.DZ,{size:"medium",children:heading}),ingress&&(0,jsx_runtime.jsx)(esm.hC,{children:ingress}),null==files?void 0:files.map((file=>file.errorMessage?(0,jsx_runtime.jsx)(FilePanelError,{file,onDelete:()=>onDelete(file)},file.vedleggId):(0,jsx_runtime.jsx)(FilePanelSuccess,{file,deleteUrl,readAttachmentUrl,onDelete:()=>{onDelete(file)}},file.vedleggId))),(0,jsx_runtime.jsx)("div",{"data-testid":"dropzone",className:"dropzone ".concat(dragOver?"dragover":""),onDragEnter:()=>setDragOver(!0),onDragLeave:()=>setDragOver(!1),onDragOver:e=>e.preventDefault(),onDrop:e=>{e.preventDefault(),e.dataTransfer.files&&validateAndSetFiles(e.dataTransfer.files),setDragOver(!1)},children:isUploading?(0,jsx_runtime.jsx)(esm.aH,{title:"Laster"}):(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("input",{id:inputId,type:"file",value:"",onChange:e=>{e.target.files&&validateAndSetFiles(e.target.files)},className:"visuallyHidden",tabIndex:-1,"data-testid":"fileinput",multiple:!0,accept:"image/*,.pdf",ref:fileInputElement,...rest}),(0,jsx_runtime.jsx)(esm.hC,{children:tekster.inputText}),(0,jsx_runtime.jsx)(esm.hC,{children:"eller"}),(0,jsx_runtime.jsx)("label",{htmlFor:inputId,"aria-labelledby":props.id,children:(0,jsx_runtime.jsxs)("span",{className:"fileInputButton navds-button navds-button__inner navds-body-short navds-button--secondary",role:"button","aria-controls":inputId,tabIndex:0,onKeyDown:event=>{var _fileInputElement_current;"Enter"===event.key&&(null==fileInputElement||null===(_fileInputElement_current=fileInputElement.current)||void 0===_fileInputElement_current||_fileInputElement_current.click())},children:[(0,jsx_runtime.jsx)(react_esm.JMY,{title:"Last opp filer","aria-hidden":!0}),tekster.labelText," ",heading.toLowerCase()]})})]})})]})};var _Primary_parameters,_Primary_parameters_docs,_Primary_parameters1,_Bokmål_parameters,_Bokmål_parameters_docs,_Bokmål_parameters1,_Nynorsk_parameters,_Nynorsk_parameters_docs,_Nynorsk_parameters1;FileInput.__docgenInfo={description:"",methods:[],displayName:"FileInput",props:{heading:{required:!0,tsType:{name:"string"},description:""},id:{required:!0,tsType:{name:"string"},description:""},onUpload:{required:!0,tsType:{name:"signature",type:"function",raw:"(attachments: Vedlegg[]) => void",signature:{arguments:[{type:{name:"Array",elements:[{name:"Vedlegg"}],raw:"Vedlegg[]"},name:"attachments"}],return:{name:"void"}}},description:""},onDelete:{required:!0,tsType:{name:"signature",type:"function",raw:"(attachment: Vedlegg) => void",signature:{arguments:[{type:{name:"Vedlegg"},name:"attachment"}],return:{name:"void"}}},description:""},deleteUrl:{required:!0,tsType:{name:"string"},description:""},uploadUrl:{required:!0,tsType:{name:"string"},description:""},readAttachmentUrl:{required:!0,tsType:{name:"string"},description:""},files:{required:!0,tsType:{name:"Array",elements:[{name:"Vedlegg"}],raw:"Vedlegg[]"},description:""},ingress:{required:!1,tsType:{name:"string"},description:""},locale:{required:!1,tsType:{name:"string"},description:""}},composes:["InputHTMLAttributes"]};const FileInput_stories={title:"FileInput",component:FileInput},Primary=args=>{const[files,setFiles]=(0,react.useState)([]);return(0,jsx_runtime.jsx)(FileInput,{...args,heading:"Annen dokumentasjon",id:"filopplasting",uploadUrl:"/upload",deleteUrl:"/delete",onUpload:attachments=>setFiles([...files,...attachments]),onDelete:attachment=>setFiles(files.filter((file=>file.id!==attachment.id))),files})},Bokmål=args=>{const[files,setFiles]=(0,react.useState)([]);return(0,jsx_runtime.jsx)(FileInput,{...args,heading:"Annen dokumentasjon",id:"filopplasting",uploadUrl:"/upload",deleteUrl:"/delete",onUpload:attachments=>setFiles([...files,...attachments]),onDelete:attachment=>setFiles(files.filter((file=>file.id!==attachment.id))),files})},Nynorsk=args=>{const[files,setFiles]=(0,react.useState)([]);return(0,jsx_runtime.jsx)(FileInput,{...args,heading:"Annen dokumentasjon",id:"filopplasting",uploadUrl:"/upload",deleteUrl:"/delete",onUpload:attachments=>setFiles([...files,...attachments]),onDelete:attachment=>setFiles(files.filter((file=>file.id!==attachment.id))),files,locale:"nn"})};Primary.parameters={...Primary.parameters,docs:{...null===(_Primary_parameters=Primary.parameters)||void 0===_Primary_parameters?void 0:_Primary_parameters.docs,source:{originalSource:"args => {\n  const [files, setFiles] = useState<Vedlegg[]>([]);\n  return <FileInput {...args} heading={'Annen dokumentasjon'} id={'filopplasting'} uploadUrl={'/upload'} deleteUrl={'/delete'} onUpload={attachments => setFiles([...files, ...attachments])} onDelete={attachment => setFiles(files.filter(file => file.id !== attachment.id))} files={files} />;\n}",...null===(_Primary_parameters1=Primary.parameters)||void 0===_Primary_parameters1||null===(_Primary_parameters_docs=_Primary_parameters1.docs)||void 0===_Primary_parameters_docs?void 0:_Primary_parameters_docs.source}}},Bokmål.parameters={...Bokmål.parameters,docs:{...null===(_Bokmål_parameters=Bokmål.parameters)||void 0===_Bokmål_parameters?void 0:_Bokmål_parameters.docs,source:{originalSource:"args => {\n  const [files, setFiles] = useState<Vedlegg[]>([]);\n  return <FileInput {...args} heading={'Annen dokumentasjon'} id={'filopplasting'} uploadUrl={'/upload'} deleteUrl={'/delete'} onUpload={attachments => setFiles([...files, ...attachments])} onDelete={attachment => setFiles(files.filter(file => file.id !== attachment.id))} files={files} />;\n}",...null===(_Bokmål_parameters1=Bokmål.parameters)||void 0===_Bokmål_parameters1||null===(_Bokmål_parameters_docs=_Bokmål_parameters1.docs)||void 0===_Bokmål_parameters_docs?void 0:_Bokmål_parameters_docs.source}}},Nynorsk.parameters={...Nynorsk.parameters,docs:{...null===(_Nynorsk_parameters=Nynorsk.parameters)||void 0===_Nynorsk_parameters?void 0:_Nynorsk_parameters.docs,source:{originalSource:"args => {\n  const [files, setFiles] = useState<Vedlegg[]>([]);\n  return <FileInput {...args} heading={'Annen dokumentasjon'} id={'filopplasting'} uploadUrl={'/upload'} deleteUrl={'/delete'} onUpload={attachments => setFiles([...files, ...attachments])} onDelete={attachment => setFiles(files.filter(file => file.id !== attachment.id))} files={files} locale={'nn'} />;\n}",...null===(_Nynorsk_parameters1=Nynorsk.parameters)||void 0===_Nynorsk_parameters1||null===(_Nynorsk_parameters_docs=_Nynorsk_parameters1.docs)||void 0===_Nynorsk_parameters_docs?void 0:_Nynorsk_parameters_docs.source}}};const __namedExportsOrder=["Primary","Bokmål","Nynorsk"]}}]);